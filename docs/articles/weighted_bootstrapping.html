<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bootstrapping with weights using rTPC • rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrapping with weights using rTPC">
<meta property="og:description" content="rTPC">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rTPC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rTPC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Fitting a single curve</li>
    <li>
      <a href="../articles/fit_many_models.html">Fitting many models with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_weighting.html">Model weighting with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a>
    </li>
    <li>
      <a href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a>
    </li>
    <li>
      <a href="../articles/weighted_bootstrapping.html">Bootstrapping with weights using rTPC</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Fitting many curves</li>
    <li>
      <a href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padpadpadpad/rTPC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="weighted_bootstrapping_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bootstrapping with weights using rTPC</h1>
                        <h4 class="author">Daniel Padfield</h4>
            
            <h4 class="date">2020-07-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/master/vignettes/weighted_bootstrapping.Rmd"><code>vignettes/weighted_bootstrapping.Rmd</code></a></small>
      <div class="hidden name"><code>weighted_bootstrapping.Rmd</code></div>

    </div>

    
    
<div id="a-brief-example-of-how-bootstrapping-can-be-implemented-alongside-model-weighting-to-account-for-model-uncertainty-alongside-measurement-uncertainty-" class="section level4">
<h4 class="hasAnchor">
<a href="#a-brief-example-of-how-bootstrapping-can-be-implemented-alongside-model-weighting-to-account-for-model-uncertainty-alongside-measurement-uncertainty-" class="anchor"></a>A brief example of how bootstrapping can be implemented alongside model weighting to account for model uncertainty alongside measurement uncertainty.</h4>
<hr>
</div>
<div id="things-to-consider" class="section level2">
<h2 class="hasAnchor">
<a href="#things-to-consider" class="anchor"></a>Things to consider</h2>
<ul>
<li><strong>This vignette is still a work in progress</strong></li>
<li>Think carefully at about your level of replication</li>
<li>We only implement this method for data re-sampling, not residual re-sampling</li>
<li>See <code><a href="../articles/bootstrapping_models.html">vignette("bootstrapping_models")</a></code> for examples of bootstrapping without weights</li>
<li>Different models will fit more or less easily based on the re-sampled data</li>
</ul>
<hr>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rTPC</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nls.multstart</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patchwork</span>)

<span class="co"># edit nls_multstart to allow for a progress bar</span>
<span class="no">nls_multstart_progress</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">formula</span>, <span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span>(), <span class="no">iter</span>, <span class="no">start_lower</span>,
                                   <span class="no">start_upper</span>, <span class="no">supp_errors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Y"</span>, <span class="st">"N"</span>), <span class="no">convergence_count</span> <span class="kw">=</span> <span class="fl">100</span>,
                                   <span class="no">control</span>, <span class="no">modelweights</span>, <span class="no">...</span>){
  <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">pb</span>)){
    <span class="no">pb</span>$<span class="fu">tick</span>()
  }
  <span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html">nls_multstart</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">formula</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>, <span class="kw">iter</span> <span class="kw">=</span> <span class="no">iter</span>, <span class="kw">start_lower</span> <span class="kw">=</span> <span class="no">start_lower</span>,
                <span class="kw">start_upper</span> <span class="kw">=</span> <span class="no">start_upper</span>, <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="no">supp_errors</span>, <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="no">convergence_count</span>,
                <span class="kw">control</span> <span class="kw">=</span> <span class="no">control</span>, <span class="kw">modelweights</span> <span class="kw">=</span> <span class="no">modelweights</span>, <span class="no">...</span>)
}</pre></body></html></div>
<p>When doing model weighting, as implemented in <code>vignette(model_weighting)</code>, the standard deviation of each point that can be used to account for measurement uncertainty and change the model fit of the thermal performance curve. However, how this approach can be combined with bootstrapping is unclear. Here, we provide three possible approaches to bootstrapping when using weighted non-linear regression to fit thermal performance curves. They all use the data re-sampling.</p>
<ol style="list-style-type: decimal">
<li>Re-sample each data point with a probability proportional to its weight and do weighted non-linear least squares regression on each bootstrapped dataset</li>
<li>Re-sample each data point irrespective of its weight, but use weighted non-linear least squares regression on each bootstrapped dataset</li>
<li>Re-sample each data point with a probability proportional to its weight and use standard non-linear least regression on each bootstrapped dataset</li>
</ol>
<p>We will demonstrate these approaches using the example in <code><a href="../articles/model_weighting.html">vignette('model_weighting')</a></code>. This vignette uses the example dataset contained within <strong>rTPC</strong> - a dataset of 60 TPCs of respiration and photosynthesis of the aquatic algae, <em>Chlorella vulgaris</em>. Instead of plotting a single curve, we average over the biological replicates, <code>rep</code>, within a growth temperature (here photosynthesis from cultures adapted to 33 ºC), to get mean rate values at each assay temperature and their standard deviation. These are then plotted using <strong>ggplot2</strong>. Instead of fitting <strong>kamykowski_1985</strong>, we will instead fit <strong>lactin2</strong> because it remains easier to fit and will need less iterations for fitting.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># get curve data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"chlorella_tpc"</span>)

<span class="no">d_ave</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">chlorella_tpc</span>, <span class="no">process</span> <span class="kw">==</span> <span class="st">'adaptation'</span>, <span class="no">growth_temp</span> <span class="kw">==</span> <span class="fl">33</span>, <span class="no">flux</span> <span class="kw">==</span> <span class="st">'photosynthesis'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>, <span class="no">flux</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="no">.</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">rate</span>),
            <span class="kw">ave_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">rate</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` regrouping output by 'temp' (override with `.groups` argument)</span>

<span class="no">d_fit</span> <span class="kw">&lt;-</span> <span class="fu">nest</span>(<span class="no">d_ave</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">weighted</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">data</span>, ~<span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html">nls_multstart</a></span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="co"># include weights here!</span>
                        <span class="kw">modelweights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>)))

<span class="co"># get predictions using augment</span>
<span class="no">newdata</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">100</span>))
<span class="no">d_preds</span> <span class="kw">&lt;-</span> <span class="no">d_fit</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">preds</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">weighted</span>, <span class="no">augment</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newdata</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">weighted</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># plot</span>
<span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/get_data-1.png" width="576" style="display: block; margin: auto;"></p>
<hr>
</div>
<div id="method-1-weighted-re-sampling-and-weighted-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#method-1-weighted-re-sampling-and-weighted-regression" class="anchor"></a>Method 1: Weighted re-sampling and weighted regression</h1>
<p>This method re-samples new datasets where each point is sampled proportionally to its standard deviation. Weighted non-linear least squares regression is then implemented on each bootstrapped dataset.</p>
<p>First we will create the re-sampled bootstrapped datasets. We will use probability weighting for the re-sampled data according to the relative sizes of the standard deviation, <span class="math inline">\(\sigma\)</span>. We calculate this for each data point, <span class="math inline">\(i\)</span>, as</p>
<p><span class="math display">\[\frac{\frac{1}{\sigma_i}}{\sum\limits_{i=1}^{n}\frac{1}{\sigma_i}}\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of data points. To keep the columns <code>temp</code>, <code>sd</code>, and <code>ave_rate</code> together, we group them together and then separate them after weighted re-sampling.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># number of boots</span>
<span class="no">n_boots</span> <span class="kw">&lt;-</span> <span class="fl">100</span>

<span class="co"># create new re-sampled datasets and prepare them for fitting</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="no">d_ave</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># creates nboot replicates of the dataset</span>
  <span class="fu">slice</span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu">n</span>(), <span class="kw">times</span> <span class="kw">=</span> <span class="no">n_boots</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">boot_num</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">n_boots</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fu">n</span>()/<span class="no">n_boots</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">boot_num</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">boot_num</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">inv_sd</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>,
         <span class="kw">prob</span> <span class="kw">=</span> <span class="no">inv_sd</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">inv_sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">unite</span>(<span class="no">.</span>, <span class="st">'resample'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ave_rate</span>, <span class="no">sd</span>, <span class="no">temp</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">'_'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">resample</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">resample</span>, <span class="fu">n</span>(), <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">prob</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">.</span>, <span class="no">resample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ave_rate'</span>, <span class="st">'sd'</span>, <span class="st">'temp'</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">'_'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ave_rate</span>, <span class="no">sd</span>, <span class="no">temp</span>), <span class="no">as.numeric</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">boot_num</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">.</span>, <span class="no">boot_num</span>, <span class="no">flux</span>, <span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)

<span class="no">d_boots</span>
<span class="co">#&gt; # A tibble: 1,100 x 5</span>
<span class="co">#&gt;    boot_num flux            temp ave_rate     sd</span>
<span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1 photosynthesis    16    0.237 0.0448</span>
<span class="co">#&gt;  2        1 photosynthesis    16    0.237 0.0448</span>
<span class="co">#&gt;  3        1 photosynthesis    16    0.237 0.0448</span>
<span class="co">#&gt;  4        1 photosynthesis    19    0.378 0.112 </span>
<span class="co">#&gt;  5        1 photosynthesis    22    0.833 0.189 </span>
<span class="co">#&gt;  6        1 photosynthesis    28    1.13  0.0507</span>
<span class="co">#&gt;  7        1 photosynthesis    40    2.51  0.218 </span>
<span class="co">#&gt;  8        1 photosynthesis    46    0.237 0.0448</span>
<span class="co">#&gt;  9        1 photosynthesis    46    0.237 0.0448</span>
<span class="co">#&gt; 10        1 photosynthesis    46    0.237 0.0448</span>
<span class="co">#&gt; # … with 1,090 more rows</span></pre></body></html></div>
<p>We will now implement weighted regression on each bootstrap.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># start progress bar and estimate time it will take</span>
<span class="no">number_of_models</span> <span class="kw">&lt;-</span> <span class="fl">1</span>

<span class="co"># setup progress bar</span>
<span class="no">pb</span> <span class="kw">&lt;-</span> <span class="kw pkg">progress</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/progress/man/progress_bar.html">progress_bar</a></span>$<span class="fu">new</span>(<span class="kw">total</span> <span class="kw">=</span> <span class="no">n_boots</span>*<span class="no">number_of_models</span>,
                                 <span class="kw">clear</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                 <span class="kw">format</span> <span class="kw">=</span><span class="st">"[:bar] :percent :elapsedfull"</span>)

<span class="no">nls_multstart_safe</span> <span class="kw">&lt;-</span> <span class="fu">possibly</span>(<span class="no">nls_multstart_progress</span>, <span class="kw">otherwise</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">quiet</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># fit each model</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu">nest</span>(<span class="no">d_boots</span>, <span class="kw">strap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">refit</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">nls_multstart_safe</span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="kw">modelweights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">.x</span>$<span class="no">sd</span>)))</pre></body></html></div>
<p>We can finally filter out any bootstrapped datasets that did not fit and plot them as before.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># remove fits that are NA</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">d_boots</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">refit</span>))
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">d_boots</span>)
<span class="co">#&gt; [1] 100</span>

<span class="co"># create new temperature data</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu">mutate</span>(<span class="no">d_boots</span>, <span class="kw">new_data</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.1</span>))),
                  <span class="co"># predict over that data</span>
                  <span class="kw">preds</span> <span class="kw">=</span>  <span class="fu">map2</span>(<span class="no">refit</span>, <span class="no">new_data</span>, ~<span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">augment</a></span>(<span class="no">.x</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">.y</span>)))

<span class="co"># calculate bootstrapped confidence intervals</span>
<span class="no">d_conf</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">temp</span>, <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.025</span>),
         <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.975</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>

<span class="co"># unnest all predictions</span>
<span class="no">d_boot_preds</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">boot_num</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># plot bootstrapped CIs</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>), <span class="no">d_conf</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># plot bootstrapped predictions</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">boot_num</span>), <span class="no">d_boot_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.03</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="no">p1</span> + <span class="no">p2</span></pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/plot_bootstrap_1-1.png" width="768" style="display: block; margin: auto;"></p>
<hr>
</div>
<div id="method-2-unweighted-re-sampling-and-weighted-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#method-2-unweighted-re-sampling-and-weighted-regression" class="anchor"></a>Method 2: Unweighted re-sampling and weighted regression</h1>
<p>This method re-samples new datasets while ignoring the standard deviations of each point, but uses weighted regression on each re-sampled bootstrapped dataset.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># create new re-sampled datasets and prepare them for fitting</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="no">d_ave</span> <span class="kw">%&gt;%</span>
  <span class="fu">do</span>(<span class="kw pkg">modelr</span><span class="kw ns">::</span><span class="fu"><a href="https://modelr.tidyverse.org/reference/bootstrap.html">bootstrap</a></span>(<span class="no">.</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_boots</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">'boot_num'</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">strap</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, <span class="no">data.frame</span>))

<span class="co"># setup progress bar</span>
<span class="no">pb</span> <span class="kw">&lt;-</span> <span class="kw pkg">progress</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/progress/man/progress_bar.html">progress_bar</a></span>$<span class="fu">new</span>(<span class="kw">total</span> <span class="kw">=</span> <span class="no">n_boots</span>*<span class="no">number_of_models</span>,
                                 <span class="kw">clear</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                 <span class="kw">format</span> <span class="kw">=</span><span class="st">"[:bar] :percent :elapsedfull"</span>)

<span class="co"># fit each model</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="no">d_boots</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">refit</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">nls_multstart_safe</span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="kw">modelweights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">.x</span>$<span class="no">sd</span>)))

<span class="co"># remove fits that are NA</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">d_boots</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">refit</span>))
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">d_boots</span>)
<span class="co">#&gt; [1] 100</span>

<span class="co"># create new temperature data</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu">mutate</span>(<span class="no">d_boots</span>, <span class="kw">new_data</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.1</span>))),
                  <span class="co"># predict over that data</span>
                  <span class="kw">preds</span> <span class="kw">=</span>  <span class="fu">map2</span>(<span class="no">refit</span>, <span class="no">new_data</span>, ~<span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">augment</a></span>(<span class="no">.x</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">.y</span>)))

<span class="co"># calculate bootstrapped confidence intervals</span>
<span class="no">d_conf</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">temp</span>, <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.025</span>),
         <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.975</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>

<span class="co"># unnest all predictions</span>
<span class="no">d_boot_preds</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">boot_num</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># plot bootstrapped CIs</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>), <span class="no">d_conf</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># plot bootstrapped predictions</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">boot_num</span>), <span class="no">d_boot_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.03</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="no">p1</span> + <span class="no">p2</span></pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/bootstrap2-1.png" width="768" style="display: block; margin: auto;"></p>
<hr>
</div>
<div id="method-3-weighted-re-sampling-and-standard-non-linear-least-squares-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#method-3-weighted-re-sampling-and-standard-non-linear-least-squares-regression" class="anchor"></a>Method 3: Weighted re-sampling and standard non-linear least squares regression</h1>
<p>This method re-samples each data point with a probability proportional to its weight and use standard non-linear least regression on each bootstrapped dataset.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># create new bootstraps</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="no">d_ave</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># creates nboot replicates of the dataset</span>
  <span class="fu">slice</span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fu">n</span>(), <span class="kw">times</span> <span class="kw">=</span> <span class="no">n_boots</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">boot_num</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">n_boots</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fu">n</span>()/<span class="no">n_boots</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">boot_num</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">boot_num</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">inv_sd</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>,
         <span class="kw">prob</span> <span class="kw">=</span> <span class="no">inv_sd</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">inv_sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">unite</span>(<span class="no">.</span>, <span class="st">'resample'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ave_rate</span>, <span class="no">sd</span>, <span class="no">temp</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">'_'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">resample</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">resample</span>, <span class="fu">n</span>(), <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="no">prob</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">.</span>, <span class="no">resample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ave_rate'</span>, <span class="st">'sd'</span>, <span class="st">'temp'</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">'_'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ave_rate</span>, <span class="no">sd</span>, <span class="no">temp</span>), <span class="no">as.numeric</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">boot_num</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">.</span>, <span class="no">boot_num</span>, <span class="no">flux</span>, <span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)

<span class="co"># setup progress bar</span>
<span class="no">pb</span> <span class="kw">&lt;-</span> <span class="kw pkg">progress</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/progress/man/progress_bar.html">progress_bar</a></span>$<span class="fu">new</span>(<span class="kw">total</span> <span class="kw">=</span> <span class="no">n_boots</span>*<span class="no">number_of_models</span>,
                                 <span class="kw">clear</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                 <span class="kw">format</span> <span class="kw">=</span><span class="st">"[:bar] :percent :elapsedfull"</span>)

<span class="co"># fit each model</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu">nest</span>(<span class="no">d_boots</span>, <span class="kw">strap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">refit</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">nls_multstart_safe</span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>)))

<span class="co"># remove fits that are NA</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">d_boots</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">refit</span>))
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">d_boots</span>)
<span class="co">#&gt; [1] 100</span>

<span class="co"># create new temperature data</span>
<span class="no">d_boots</span> <span class="kw">&lt;-</span> <span class="fu">mutate</span>(<span class="no">d_boots</span>, <span class="kw">new_data</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">strap</span>, ~<span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">.x</span>$<span class="no">temp</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fl">0.1</span>))),
                  <span class="co"># predict over that data</span>
                  <span class="kw">preds</span> <span class="kw">=</span>  <span class="fu">map2</span>(<span class="no">refit</span>, <span class="no">new_data</span>, ~<span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">augment</a></span>(<span class="no">.x</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">.y</span>)))

<span class="co"># calculate bootstrapped confidence intervals</span>
<span class="no">d_conf</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">temp</span>, <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.025</span>),
         <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">.fitted</span>, <span class="fl">0.975</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>

<span class="co"># unnest all predictions</span>
<span class="no">d_boot_preds</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_boots</span>, <span class="no">boot_num</span>, <span class="no">preds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># plot bootstrapped CIs</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>), <span class="no">d_conf</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># plot bootstrapped predictions</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">boot_num</span>), <span class="no">d_boot_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.03</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="no">p1</span> + <span class="no">p2</span></pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/bootstrap3-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Padfield, Hannah O'Sullivan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
