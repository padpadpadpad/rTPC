<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bootstrapping with weights using rTPC • rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrapping with weights using rTPC">
<meta property="og:description" content="rTPC">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rTPC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rTPC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Fitting a single curve</li>
    <li>
      <a href="../articles/fit_many_models.html">Fitting many models with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_weighting.html">Model weighting with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a>
    </li>
    <li>
      <a href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a>
    </li>
    <li>
      <a href="../articles/weighted_bootstrapping.html">Bootstrapping with weights using rTPC</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Fitting many curves</li>
    <li>
      <a href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padpadpadpad/rTPC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="weighted_bootstrapping_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bootstrapping with weights using rTPC</h1>
                        <h4 class="author">Daniel Padfield</h4>
            
            <h4 class="date">2020-09-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/master/vignettes/weighted_bootstrapping.Rmd"><code>vignettes/weighted_bootstrapping.Rmd</code></a></small>
      <div class="hidden name"><code>weighted_bootstrapping.Rmd</code></div>

    </div>

    
    
<div id="a-brief-example-of-how-bootstrapping-can-be-implemented-alongside-model-weighting-to-account-for-model-uncertainty-alongside-measurement-uncertainty-" class="section level4">
<h4 class="hasAnchor">
<a href="#a-brief-example-of-how-bootstrapping-can-be-implemented-alongside-model-weighting-to-account-for-model-uncertainty-alongside-measurement-uncertainty-" class="anchor"></a>A brief example of how bootstrapping can be implemented alongside model weighting to account for model uncertainty alongside measurement uncertainty.</h4>
<hr>
</div>
<div id="things-to-consider" class="section level2">
<h2 class="hasAnchor">
<a href="#things-to-consider" class="anchor"></a>Things to consider</h2>
<ul>
<li>Think carefully about your level of replication</li>
<li>Bootstrapping weighted non-linear least squares is implemented using <strong>car::Boot()</strong>
</li>
<li>See <code><a href="../articles/bootstrapping_models.html">vignette("bootstrapping_models")</a></code> for examples of bootstrapping without weights</li>
<li>The outcomes of the different approaches outlined here are likely to change based on the data and the model used. Use this methods with caution and think critically about their output</li>
</ul>
<hr>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">boot</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">car</span>) <span class="co"># to install development version of car install.packages("car", repos = c("http://R-Forge.R-project.org"), dep = FALSE)</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rTPC</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nls.multstart</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patchwork</span>)</pre></body></html></div>
<p>When doing model weighting, as implemented in <code>vignette(model_weighting)</code>, the standard deviation of each point can be used to account for measurement uncertainty and can improve the model fit and reduce biases in parameter estimates. As in <code>vignette(bootstrapping_models</code>)`, <strong>car::Boot()</strong> can be used to do both case and residual resampling on the weighted regression model.</p>
<p>In case resampling, each iteration re-samples the original data with replacement (where each rate, temperature and measurement error value are linked) and uses weighted weighted non-linear least squares regression on each bootstrapped dataset.</p>
<p>In residual resampling of weighted non-linear regression, the weights are used as a correction to the Pearson residuals. The whole function can be viewed by using <code><a href="https://rdrr.io/r/utils/getAnywhere.html">getAnywhere(Boot.nls)</a></code>. For large samples the residual method must be ok, but the small sample properties are less clear. Ideally one would be inclined not to use the case resampling bootstrap when possible because the theory is more certain.</p>
<p>We will demonstrate both approaches using the example in <code><a href="../articles/model_weighting.html">vignette('model_weighting')</a></code>. This vignette uses the example dataset contained within <strong>rTPC</strong> - a dataset of 60 TPCs of respiration and photosynthesis of the aquatic algae, <em>Chlorella vulgaris</em>. Instead of plotting a single curve, we average over the biological replicates, <code>rep</code>, within a growth temperature (here photosynthesis from cultures adapted to 33 ºC), to get mean rate values at each assay temperature and their standard deviation. These are then plotted using <strong>ggplot2</strong>. Instead of fitting <strong>kamykowski_1985</strong>, we will instead fit <strong>lactin2_1995</strong> in this example.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># get curve data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"chlorella_tpc"</span>)

<span class="no">d_ave</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">chlorella_tpc</span>, <span class="no">process</span> <span class="kw">==</span> <span class="st">'adaptation'</span>, <span class="no">growth_temp</span> <span class="kw">==</span> <span class="fl">33</span>, <span class="no">flux</span> <span class="kw">==</span> <span class="st">'photosynthesis'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>, <span class="no">flux</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="no">.</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">rate</span>),
            <span class="kw">ave_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">rate</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` regrouping output by 'temp' (override with `.groups` argument)</span>

<span class="no">d_fit</span> <span class="kw">&lt;-</span> <span class="fu">nest</span>(<span class="no">d_ave</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">weighted</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">data</span>, ~<span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html">nls_multstart</a></span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="co"># include weights here!</span>
                        <span class="kw">modelweights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>)))

<span class="co"># get predictions using augment</span>
<span class="no">newdata</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">100</span>))
<span class="no">d_preds</span> <span class="kw">&lt;-</span> <span class="no">d_fit</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">preds</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">weighted</span>, <span class="no">augment</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newdata</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">weighted</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># plot</span>
<span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.25</span>, <span class="fl">3.5</span>))</pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/get_data-1.png" width="576" style="display: block; margin: auto;"></p>
<hr>
</div>
<div id="method-1-case-resampling-weighted-non-linear-regression-" class="section level1">
<h1 class="hasAnchor">
<a href="#method-1-case-resampling-weighted-non-linear-regression-" class="anchor"></a>Method 1: Case resampling weighted non-linear regression.</h1>
<p>In this method, each iteration re-samples the original data with replacement (where each rate, temperature and measurement error value are linked) and uses weighted weighted non-linear least squares regression on each bootstrapped dataset.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># refit model using nlsLM</span>
<span class="no">fit_nlsLM</span> <span class="kw">&lt;-</span> <span class="kw pkg">minpack.lm</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html">nlsLM</a></span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">d_ave</span>,
                        <span class="kw">start</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">d_fit</span>$<span class="no">weighted</span><span class="kw">[[</span><span class="fl">1</span>]]),
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>, <span class="no">d_ave</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>, <span class="no">d_ave</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'lactin2_1995'</span>),
                        <span class="kw">weights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>)

<span class="co"># perform case bootstrap</span>
<span class="no">boot1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Boot.html">Boot</a></span>(<span class="no">fit_nlsLM</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'case'</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Number of bootstraps was 668 out of 999 attempted</span></pre></body></html></div>
<p>We can also create model predictions for each bootstrap and confidence intervals of model predictions using the methods implemented in <code>vignette(bootstrapping_models)</code>. These can then be plotted using <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># predict over new data</span>
<span class="no">boot1_preds</span> <span class="kw">&lt;-</span> <span class="no">boot1</span>$<span class="no">t</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">drop_na</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">iter</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">group_by_all</span>() <span class="kw">%&gt;%</span>
  <span class="fu">do</span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">100</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">pred</span> <span class="kw">=</span> <span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>))

<span class="co"># calculate bootstrapped confidence intervals</span>
<span class="no">boot1_conf_preds</span> <span class="kw">&lt;-</span> <span class="fu">group_by</span>(<span class="no">boot1_preds</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">pred</span>, <span class="fl">0.025</span>),
            <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">pred</span>, <span class="fl">0.975</span>),
            <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">'drop'</span>)

<span class="co"># plot bootstrapped CIs</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>), <span class="no">boot1_conf_preds</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>, <span class="fl">3.5</span>))

<span class="co"># plot bootstrapped predictions</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">pred</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">iter</span>), <span class="no">boot1_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.007</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>, <span class="fl">3.5</span>))

<span class="no">p1</span> + <span class="no">p2</span></pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/bootstrap1-1.png" width="768" style="display: block; margin: auto;"></p>
<p>For this model formulation, the case resampling method gives really wide confidence intervals for the model predictions at high temperatures. In some of the bootstrapped datasets, the rate value at 49 ºC is not present, which results in a drastically different fit which predicts extremely negative rates for 49 ºC in those instances. As such, this is likely a bigger problem with models that allow for negative rates. Those that do not allow negative rates may not suffer so much from this issue as the mathematical formulation forces rates to always be positive, limiting the wide variation in negative rate values. However these models are also likely to have other disadvantages.</p>
<hr>
</div>
<div id="method-2-residual-resampling-weighted-non-linear-regression-" class="section level1">
<h1 class="hasAnchor">
<a href="#method-2-residual-resampling-weighted-non-linear-regression-" class="anchor"></a>Method 2: Residual resampling weighted non-linear regression.</h1>
<p>In this method, the weights are used as a correction to the Pearson residuals of the original model fit. These modified residuals are then added onto the fitted model predictions, mimicking the methods used for weighted linear regression (Algorithm 6.3 in Davison and Hinkley (2003)). The implementation in <strong>Boot()</strong> can be viewed by using <code><a href="https://rdrr.io/r/utils/getAnywhere.html">getAnywhere(Boot.nls)</a></code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># perform residual bootstrap</span>
<span class="no">boot2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/Boot.html">Boot</a></span>(<span class="no">fit_nlsLM</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'residual'</span>)

<span class="co"># predict over new data</span>
<span class="no">boot2_preds</span> <span class="kw">&lt;-</span> <span class="no">boot2</span>$<span class="no">t</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">drop_na</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">iter</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">group_by_all</span>() <span class="kw">%&gt;%</span>
  <span class="fu">do</span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">100</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">pred</span> <span class="kw">=</span> <span class="fu"><a href="../reference/lactin2_1995.html">lactin2_1995</a></span>(<span class="no">temp</span>, <span class="no">a</span>, <span class="no">b</span>, <span class="no">tmax</span>, <span class="no">delta_t</span>))

<span class="co"># calculate bootstrapped confidence intervals</span>
<span class="no">boot2_conf_preds</span> <span class="kw">&lt;-</span> <span class="fu">group_by</span>(<span class="no">boot2_preds</span>, <span class="no">temp</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">pred</span>, <span class="fl">0.025</span>),
            <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">pred</span>, <span class="fl">0.975</span>),
            <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">'drop'</span>)

<span class="co"># plot bootstrapped CIs</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>), <span class="no">boot2_conf_preds</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>, <span class="fl">3.5</span>))

<span class="co"># plot bootstrapped predictions</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>), <span class="no">d_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">pred</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">iter</span>), <span class="no">boot2_preds</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">'black'</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.007</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">10</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">3</span>, <span class="fl">3.5</span>))

<span class="no">p1</span> + <span class="no">p2</span></pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/bootstrap2-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="calculating-confidence-intervals-of-estimated-and-calculated-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-confidence-intervals-of-estimated-and-calculated-parameters" class="anchor"></a>Calculating confidence intervals of estimated and calculated parameters</h1>
<p>As for standard non-linear regression, bootstrapping can estimate confidence intervals of the parameters explicitly modelled in the weighted regression. We can compare this approach to profiled confidence intervals (using <strong>confint-MASS</strong>) and asymptotic confidence intervals (using <strong>nlstools::confint2()</strong>).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># get parameters of fitted model</span>
<span class="no">param</span> <span class="kw">&lt;-</span> <span class="kw pkg">broom</span><span class="kw ns">::</span><span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">tidy</a></span>(<span class="no">fit_nlsLM</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">param</span> <span class="kw">=</span> <span class="no">term</span>, <span class="no">estimate</span>)

<span class="co"># calculate confidence intervals of models</span>
<span class="no">ci1</span> <span class="kw">&lt;-</span> <span class="kw pkg">nlstools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlstools/man/confint2.html">confint2</a></span>(<span class="no">fit_nlsLM</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'asymptotic'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rownames_to_column</span>(<span class="no">.</span>, <span class="kw">var</span> <span class="kw">=</span> <span class="st">'param'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">'asymptotic'</span>)
<span class="no">ci2</span> <span class="kw">&lt;-</span> <span class="kw pkg">nlstools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/nlstools/man/confint2.html">confint2</a></span>(<span class="no">fit_nlsLM</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'profile'</span>)
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Error in prof$getProfile(): number of iterations exceeded maximum of 50</span>
<span class="co"># profiling method fails</span>
<span class="no">ci2</span> <span class="kw">&lt;-</span> <span class="fu">mutate</span>(<span class="no">ci1</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'profile'</span>,
                    <span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fl">NA</span>,
                    <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fl">NA</span>)

<span class="co"># CIs from case resampling</span>
<span class="no">ci3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">boot1</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'bca'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rownames_to_column</span>(<span class="no">.</span>, <span class="kw">var</span> <span class="kw">=</span> <span class="st">'param'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">'case bootstrap'</span>)

<span class="co"># CIs from residual resampling</span>
<span class="no">ci4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">boot2</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'bca'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">conf_lower</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">conf_upper</span> <span class="kw">=</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rownames_to_column</span>(<span class="no">.</span>, <span class="kw">var</span> <span class="kw">=</span> <span class="st">'param'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">'residual bootstrap'</span>)

<span class="no">ci</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">ci1</span>, <span class="no">ci2</span>, <span class="no">ci3</span>, <span class="no">ci4</span>) <span class="kw">%&gt;%</span>
  <span class="fu">full_join</span>(<span class="no">.</span>, <span class="no">param</span>)
<span class="co">#&gt; Joining, by = "param"</span>

<span class="fu">ggplot</span>(<span class="no">ci</span>, <span class="fu">aes</span>(<span class="kw pkg">forcats</span><span class="kw ns">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span>(<span class="no">method</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'profile'</span>, <span class="st">'asymptotic'</span>)), <span class="no">estimate</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">method</span>)) +
  <span class="fu">geom_point</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">conf_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">conf_upper</span>)) +
  <span class="fu">theme_bw</span>() +
  <span class="fu">facet_wrap</span>(~<span class="no">param</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">'free'</span>) +
  <span class="fu">scale_x_discrete</span>(<span class="st">''</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="kw pkg">stringr</span><span class="kw ns">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span>(<span class="no">x</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">10</span>)) +
  <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'Calculation of confidence intervals for model parameters'</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">'For the chlorella TPC; profile method failes'</span>)</pre></body></html></div>
<p><img src="weighted_bootstrapping_files/figure-html/conf_int-1.png" width="700" style="display: block; margin: auto;"> Here the profiling approach fails, and the residual method returns values that are narrower than those created from asymptotic intervals. The case bootstrap does not work well. The bootstrapping approaches could also be used to estimate the uncertainty in the derived parameters, as in <code>vignette(bootstrapping_models)</code>.</p>
<div id="further-reading" class="section level4">
<h4 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further reading</h4>
<ul>
<li>John Fox (author of car) on bootstrapping regression models in R
<ul>
<li><a href="https://statweb.stanford.edu/~owen/courses/305a/FoxOnBootingRegInR.pdf" class="uri">https://statweb.stanford.edu/~owen/courses/305a/FoxOnBootingRegInR.pdf</a></li>
</ul>
</li>
<li>A.C. Davison &amp; D.V. Hinkley (2003) Bootstrap Methods and their Application. - <a href="https://www.cambridge.org/core/books/bootstrap-methods-and-their-application/ED2FD043579F27952363566DC09CBD6A" class="uri">https://www.cambridge.org/core/books/bootstrap-methods-and-their-application/ED2FD043579F27952363566DC09CBD6A</a>
</li>
<li>Schenker, N., &amp; Gentleman, J. F. (2001). On judging the significance of differences by examining the overlap between confidence intervals. The American Statistician, 55(3), 182-186.</li>
<li>Puth, M. T., Neuhäuser, M., &amp; Ruxton, G. D. (2015). On the variety of methods for calculating confidence intervals by bootstrapping. Journal of Animal Ecology, 84(4), 892-897.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Padfield, Hannah O'Sullivan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
