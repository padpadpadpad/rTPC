<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting many curves using rTPC • rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Fitting many curves using rTPC">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rTPC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rTPC.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting a single curve</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_models.html">Fitting many models with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_weighting.html">Model weighting with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/weighted_bootstrapping.html">Bootstrapping with weights using rTPC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting many curves</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_many_curves.html">Bootstrapping many curves using rTPC</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/padpadpadpad/rTPC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting many curves using rTPC</h1>
                        <h4 data-toc-skip class="author">Daniel
Padfield</h4>
            
            <h4 data-toc-skip class="date">2024-08-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/HEAD/vignettes/fit_many_curves.Rmd" class="external-link"><code>vignettes/fit_many_curves.Rmd</code></a></small>
      <div class="d-none name"><code>fit_many_curves.Rmd</code></div>
    </div>

    
    
<div class="section level4">
<h4 id="a-brief-example-of-how-to-fit-many-models-to-multiple-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-">A brief example of how to fit many models to multiple TPCs using
rTPC, nls.multstart and the tidyverse.<a class="anchor" aria-label="anchor" href="#a-brief-example-of-how-to-fit-many-models-to-multiple-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-"></a>
</h4>
<hr>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/padpadpadpad/rTPC" class="external-link">rTPC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">nls.multstart</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>In the final part of the general pipeline, we demonstrate how
multiple models can be fitted to multiple TPCs. Instead of picking all
24 model formulations to demonstrate this approach, we will use only 2
models in this example: <strong>gaussian_1987()</strong> and
<strong>sharpeschoolhigh_1981()</strong>.</p>
<p>We can demonstrate the fitting of multiple curves by modelling all 60
TPCs from the example dataset of <strong>rTPC</strong> curve from the
example dataset <strong>rTPC</strong>. These TPCs are of respiration and
photosynthesis of the aquatic algae, <em>Chlorella vulgaris</em>. These
algae differed in their growth temperature, <code>growth_temp</code>,
and how long they had been grown at that temperature,
<code>process</code>, either for ~100 or ~10 generations.</p>
<p>Using a similar approach to <code><a href="../articles/fit_many_models.html">vignette('fit_many_models')</a></code>,
models can be fitted to each curve using list columns and
<strong>purrr::map()</strong> to fit and store multiple models in a data
frame.</p>
<p>When fitting lots of models at once, it is useful to know the
progress the code as it may take a long time to run.The R package
<strong>purrr</strong> does now has progress bars built in; you can add
a progress bar to the <strong>map()</strong> function using the argument
<em>.progress</em>. However, when fitting multiple models with multiple
<strong>map()</strong> calls a new progress bar each time, so currently
I have not found a way to have a single progress bar for multiple
<strong>map()</strong> calls, so we will keep with what we have at the
moment.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"chlorella_tpc"</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">chlorella_tpc</span></span>
<span></span>
<span><span class="co"># when scaling up our code to fit hundreds of models, its nice to have a progress bar</span></span>
<span><span class="co"># edit nls_multstart to allow for a progress bar</span></span>
<span><span class="va">nls_multstart_progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">iter</span>, <span class="va">start_lower</span>, </span>
<span>                                   <span class="va">start_upper</span>, <span class="va">supp_errors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="st">"N"</span><span class="op">)</span>, <span class="va">convergence_count</span> <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                   <span class="va">control</span>, <span class="va">modelweights</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">pb</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pb</span><span class="op">$</span><span class="fu">tick</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html" class="external-link">nls_multstart</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span>, iter <span class="op">=</span> <span class="va">iter</span>, start_lower <span class="op">=</span> <span class="va">start_lower</span>, </span>
<span>                start_upper <span class="op">=</span> <span class="va">start_upper</span>, supp_errors <span class="op">=</span> <span class="va">supp_errors</span>, convergence_count <span class="op">=</span> <span class="va">convergence_count</span>, </span>
<span>                control <span class="op">=</span> <span class="va">control</span>, modelweights <span class="op">=</span> <span class="va">modelweights</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># start progress bar and estimate time it will take</span></span>
<span><span class="va">number_of_models</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">number_of_curves</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">curve_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setup progress bar</span></span>
<span><span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu">progress</span><span class="fu">::</span><span class="va"><a href="http://r-lib.github.io/progress/reference/progress_bar.html" class="external-link">progress_bar</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>total <span class="op">=</span> <span class="va">number_of_curves</span><span class="op">*</span><span class="va">number_of_models</span>,</span>
<span>                                 clear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 format <span class="op">=</span><span class="st">"[:bar] :percent :elapsedfull"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit two chosen model formulation in rTPC</span></span>
<span><span class="va">d_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="va">d</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gaussian <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu">nls_multstart_progress</span><span class="op">(</span><span class="va">rate</span><span class="op">~</span><span class="fu"><a href="../reference/gaussian_1987.html">gaussian_1987</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>, <span class="va">rmax</span>,<span class="va">topt</span>,<span class="va">a</span><span class="op">)</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                        iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                        start_lower <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'gaussian_1987'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>                        start_upper <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'gaussian_1987'</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'gaussian_1987'</span><span class="op">)</span>,</span>
<span>                        upper <span class="op">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'gaussian_1987'</span><span class="op">)</span>,</span>
<span>                        supp_errors <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                        convergence_count <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         sharpeschoolhigh <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu">nls_multstart_progress</span><span class="op">(</span><span class="va">rate</span><span class="op">~</span><span class="fu"><a href="../reference/sharpeschoolhigh_1981.html">sharpeschoolhigh_1981</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>, <span class="va">r_tref</span>,<span class="va">e</span>,<span class="va">eh</span>,<span class="va">th</span>, tref <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                        iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                        start_lower <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'sharpeschoolhigh_1981'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>                        start_upper <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'sharpeschoolhigh_1981'</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'sharpeschoolhigh_1981'</span><span class="op">)</span>,</span>
<span>                        upper <span class="op">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'sharpeschoolhigh_1981'</span><span class="op">)</span>,</span>
<span>                        supp_errors <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                        convergence_count <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[=========================================================] 100% 00:00:40</code></pre>
<p>Like previous vignettes, the predictions of each model can be
estimated using <strong>broom::augment()</strong>. To do this, we first
create a new list column containing high resolution temperature values
by taking the <code>min</code> and <code>max</code> of each curve. Next
we stack the models and finally we get the new predictions using the
<strong>map2()</strong>, which allows us to use both <code>fit</code>
and <code>new_data</code> list columns. After unnesting the
<code>preds</code> column, we are then left with high resolution
predictions for each curve. As this code covers a lot of steps, each
line of the code is commented.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create new list column of for high resolution data</span></span>
<span><span class="va">d_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">d_fits</span>, new_data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># get rid of original data column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># stack models into a single column, with an id column for model_name</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, names_to <span class="op">=</span> <span class="st">'model_name'</span>, values_to <span class="op">=</span> <span class="st">'fit'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gaussian</span>,<span class="va">sharpeschoolhigh</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># create new list column containing the predictions</span></span>
<span>  <span class="co"># this uses both fit and new_data list columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>preds <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">new_data</span>, <span class="op">~</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">.x</span>, newdata <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># select only the columns we want to keep</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">curve_id</span>, <span class="va">growth_temp</span>, <span class="va">process</span>, <span class="va">flux</span>, <span class="va">model_name</span>, <span class="va">preds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># unlist the preds list column</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">d_preds</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 12,000</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ curve_id    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span><span class="co">#&gt; $ growth_temp <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20…</span></span>
<span><span class="co">#&gt; $ process     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "acclimation", "acclimation", "acclimation", "acclimation"…</span></span>
<span><span class="co">#&gt; $ flux        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "respiration", "respiration", "respiration", "respiration"…</span></span>
<span><span class="co">#&gt; $ model_name  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "gaussian", "gaussian", "gaussian", "gaussian", "gaussian"…</span></span>
<span><span class="co">#&gt; $ temp        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 16.00000, 16.33333, 16.66667, 17.00000, 17.33333, 17.66667…</span></span>
<span><span class="co">#&gt; $ .fitted     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.02790076, 0.03175769, 0.03607053, 0.04088150, 0.04623512…</span></span></code></pre></div>
<p>We can then plot the predictions of each curve using
<strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">d_preds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">.fitted</span>, col <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">rate</span><span class="op">)</span>, <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">curve_id</span>, scales <span class="op">=</span> <span class="st">'free_y'</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'qual'</span>, palette <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Temperature (ºC)'</span>,</span>
<span>       y <span class="op">=</span> <span class="st">'Metabolic rate'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">'All fitted thermal performance curves'</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">'gaussian in green; sharpeschoolhigh in orange'</span><span class="op">)</span></span></code></pre></div>
<p><img src="fit_many_curves_files/figure-html/plot-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The traits of each thermal performance curve can also easily be
calculated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack models and calculate extra params</span></span>
<span><span class="va">d_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">d_fits</span>, names_to <span class="op">=</span> <span class="st">'model_name'</span>, values_to <span class="op">=</span> <span class="st">'fit'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gaussian</span>,<span class="va">sharpeschoolhigh</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">calc_params</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">curve_id</span>, <span class="va">growth_temp</span>, <span class="va">process</span>, <span class="va">flux</span>, <span class="va">model_name</span>, <span class="va">params</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">d_params</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 120</span></span>
<span><span class="co">#&gt; Columns: 16</span></span>
<span><span class="co">#&gt; $ curve_id              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, …</span></span>
<span><span class="co">#&gt; $ growth_temp           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 20, 20, 20, 20, 23, 23, 27, 27, 27, 27, 30, 30, …</span></span>
<span><span class="co">#&gt; $ process               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "acclimation", "acclimation", "acclimation", "ac…</span></span>
<span><span class="co">#&gt; $ flux                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "respiration", "respiration", "respiration", "re…</span></span>
<span><span class="co">#&gt; $ model_name            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "gaussian", "sharpeschoolhigh", "gaussian", "sha…</span></span>
<span><span class="co">#&gt; $ rmax                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.4972473, 1.8127063, 1.7935416, 1.9798352, 0.94…</span></span>
<span><span class="co">#&gt; $ topt                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 36.338, 41.646, 35.554, 39.007, 34.615, 35.170, …</span></span>
<span><span class="co">#&gt; $ ctmin                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 18.695, 2.539, 18.835, 6.086, 17.368, 11.970, 15…</span></span>
<span><span class="co">#&gt; $ ctmax                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 53.981, 45.558, 52.272, 47.680, 51.861, 53.064, …</span></span>
<span><span class="co">#&gt; $ e                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.6758954, 0.5802496, 0.8427748, 0.6621701, 1.02…</span></span>
<span><span class="co">#&gt; $ eh                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.0767825, 11.4840311, 1.0954099, 2.4774826, 1.1…</span></span>
<span><span class="co">#&gt; $ q10                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.373766, 2.063147, 2.927011, 2.305129, 3.722119…</span></span>
<span><span class="co">#&gt; $ thermal_safety_margin <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 17.643, 3.912, 16.718, 8.673, 17.246, 17.894, 18…</span></span>
<span><span class="co">#&gt; $ thermal_tolerance     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 35.286, 43.019, 33.437, 41.594, 34.493, 41.094, …</span></span>
<span><span class="co">#&gt; $ breadth               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 9.651, 5.371, 9.165, 6.495, 9.442, 7.714, 10.354…</span></span>
<span><span class="co">#&gt; $ skewness              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -4.008871e-01, -1.090378e+01, -2.526351e-01, -1.…</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Padfield, Hannah O’Sullivan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
