<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding Models to rTPC • rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Adding Models to rTPC">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rTPC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rTPC.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting a single curve</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_models.html">Fitting many models with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_weighting.html">Model weighting with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/weighted_bootstrapping.html">Bootstrapping with weights using rTPC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting many curves</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_many_curves.html">Bootstrapping many curves using rTPC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Contributing to rTPC</h6></li>
    <li><a class="dropdown-item" href="../articles/adding_models.html">Adding Models to rTPC</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/padpadpadpad/rTPC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adding Models to rTPC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/master/vignettes/adding_models.Rmd" class="external-link"><code>vignettes/adding_models.Rmd</code></a></small>
      <div class="d-none name"><code>adding_models.Rmd</code></div>
    </div>

    
    
<p>So you want to contribute a model to <strong>rTPC</strong>? That’s
awesome!</p>
<p>Here we will go through all the major steps for creating and
contributing a model to <strong>rTPC</strong>.</p>
<p>This vignette assumes that you have a working knowledge of basic git
usage (either through the terminal, the RStudio interface, or another
GUI), of R, and a functional knowledge of thermal performance
curves.</p>
<hr>
<div class="section level2">
<h2 id="first-steps">First steps<a class="anchor" aria-label="anchor" href="#first-steps"></a>
</h2>
<p>The first thing you want to do when you have a model that is
potentially useful in <strong>rTPC</strong> is to <em>check whether it’s
already there</em>!</p>
<p>rTPC already contains 49 models designed on a variety of different
data. It is quite likely at this point that there is a similar (or
identical) model that already serves the same purpose. So why not save
yourself the work if you can?</p>
<p>You can find all the models currently available using
<code><a href="../reference/get_model_names.html">rTPC::get_model_names()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show all models in rTPC</span></span>
<span><span class="fu">rTPC</span><span class="fu">::</span><span class="fu"><a href="../reference/get_model_names.html">get_model_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "analytiskontodimas_2004"       "ashrafi1_2018"                </span></span>
<span><span class="co">#&gt;  [3] "ashrafi2_2018"                 "ashrafi3_2018"                </span></span>
<span><span class="co">#&gt;  [5] "ashrafi4_2018"                 "ashrafi5_2018"                </span></span>
<span><span class="co">#&gt;  [7] "atkin_2005"                    "beta_2012"                    </span></span>
<span><span class="co">#&gt;  [9] "betatypesimplified_2008"       "boatman_2017"                 </span></span>
<span><span class="co">#&gt; [11] "briere1_1999"                  "briere1simplified_1999"       </span></span>
<span><span class="co">#&gt; [13] "briere2_1999"                  "briere2simplified_1999"       </span></span>
<span><span class="co">#&gt; [15] "briereextended_2021"           "briereextendedsimplified_2021"</span></span>
<span><span class="co">#&gt; [17] "delong_2017"                   "deutsch_2008"                 </span></span>
<span><span class="co">#&gt; [19] "eubank_1973"                   "flextpc_2024"                 </span></span>
<span><span class="co">#&gt; [21] "flinn_1991"                    "gaussian_1987"                </span></span>
<span><span class="co">#&gt; [23] "gaussianmodified_2006"         "hinshelwood_1947"             </span></span>
<span><span class="co">#&gt; [25] "janisch1_1925"                 "janisch2_1925"                </span></span>
<span><span class="co">#&gt; [27] "joehnk_2008"                   "johnsonlewin_1946"            </span></span>
<span><span class="co">#&gt; [29] "kamykowski_1985"               "lactin2_1995"                 </span></span>
<span><span class="co">#&gt; [31] "lobry_1991"                    "mitchell_2009"                </span></span>
<span><span class="co">#&gt; [33] "oneill_1972"                   "pawar_2018"                   </span></span>
<span><span class="co">#&gt; [35] "quadratic_2008"                "ratkowsky_1983"               </span></span>
<span><span class="co">#&gt; [37] "rezende_2019"                  "rosso_1993"                   </span></span>
<span><span class="co">#&gt; [39] "sharpeschoolfull_1981"         "sharpeschoolhigh_1981"        </span></span>
<span><span class="co">#&gt; [41] "sharpeschoollow_1981"          "spain_1982"                   </span></span>
<span><span class="co">#&gt; [43] "stinner_1974"                  "taylorsexton_1972"            </span></span>
<span><span class="co">#&gt; [45] "thomas_2012"                   "thomas_2017"                  </span></span>
<span><span class="co">#&gt; [47] "tomlinsonphillips_2015"        "warrendreyer_2006"            </span></span>
<span><span class="co">#&gt; [49] "weibull_1995"</span></span></code></pre></div>
<hr>
<div class="section level3">
<h3 id="forking-the-repository">Forking the repository<a class="anchor" aria-label="anchor" href="#forking-the-repository"></a>
</h3>
<p>The easiest way to start working on rTPC is to <strong>fork</strong>
the repo. <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo" class="external-link">Github
has some excellent instructions on doing this</a>.</p>
<p>Working on a fork of the repository will allow you to commit to rTPC
as if it is your own project, and then contribute those commits back to
the main repository through a <strong>pull request</strong>.</p>
</div>
<div class="section level3">
<h3 id="setting-up-your-workspace-and-r-installation">Setting up your workspace and R installation<a class="anchor" aria-label="anchor" href="#setting-up-your-workspace-and-r-installation"></a>
</h3>
<p>It is <em>strongly</em> suggested that you install all packages from
the “Suggests” section of rTPC (easily found in the DESCRIPTION file),
alongside the packages <code>devtools</code> and <code>usethis</code>
(see <a href="https://r-pkgs.org/setup.html" class="external-link">here</a> for a deeper
explanation of these packages).</p>
<p>Once you have done this, git clone from YOUR fork of rTPC into a
folder of your choice on your computer, and then open up the
<code>rTPC.Rproj</code> file if you are using RStudio.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="adding-a-model">Adding a model<a class="anchor" aria-label="anchor" href="#adding-a-model"></a>
</h2>
<p>Adding a model to rTPC consists of 4 major steps:</p>
<ol style="list-style-type: decimal">
<li>Add the model code, starting values, and limits.</li>
<li>Add the test file.</li>
<li>Add the model to the rTPC database.</li>
<li>Clean up and check.</li>
</ol>
<p>Models are generally named according to the scheme
<code>authormodifier_YYYY</code>. So a model by authors called King and
Bishop published in 1992 would usually be codified as
<code>kingbishop_1992</code>. If they also proposed a modified model,
and a simplified version of each in the original paper, those would
probably appear as</p>
<ul>
<li><code>kingbishopmodified_1992</code></li>
<li><code>kingbishopsimplified_1992</code></li>
<li><code>kingbishopmodifiedsimplified_1992</code></li>
</ul>
<p>If there are many authors, or another better description of the model
then initials or other descriptors may be used, but these may be changed
if the package maintainers think there are simpler, more consistent, and
more identifiable names.</p>
<hr>
<div class="section level3">
<h3 id="model-equation">Model equation<a class="anchor" aria-label="anchor" href="#model-equation"></a>
</h3>
<p>For this example, let’s implement the Eubank model from <a href="https://academic.oup.com/ee/article/2/4/491/2480483" class="external-link">The
Significance and Thermodynamics of Fluctuating Versus Static Thermal
Environments on <em>Heliothis zea</em> Egg Development Rates</a>.</p>
<p>This model (eq4) is originally derived just for a bollworm, with some
magic numbers:</p>
<p><span class="math display">\[R(T) =
\frac{800}{(T-91)^2+432}\]</span></p>
<p>As a generalisation, we know from looking at the paper that <span class="math inline">\(T_{opt} = 91\)</span>, and the numbers 800 and 432
are species-specific (and thus should be fit).</p>
<p>As such we can reformulate the equation as:</p>
<p><span class="math display">\[rate(temp) =
\frac{a}{(temp-T_{opt})^2+b}\]</span></p>
<p>Where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are arbitrary parameters for fitting,
and <span class="math inline">\(T_{opt}\)</span> can be at least
approximated from the data.</p>
<hr>
</div>
<div class="section level3">
<h3 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h3>
<p>The model itself lives in a file named after the function, in the
<code>R</code> directory. In our case that will be
<code>eubank_1973.R</code>.</p>
<p>You can create one using the function
<code>usethis::use_r("eubank_1973")</code></p>
<p>Within this file are 4 functions:</p>
<ul>
<li>
<code><a href="../reference/eubank_1973.html">eubank_1973()</a></code> - The model itself</li>
<li>
<code>eubank_1973.starting_vals()</code> - The starting values</li>
<li>
<code>eubank_1973.lower_lims()</code> - The lower limits</li>
<li>
<code>eubank_1973.upper_lims()</code> - The upper limits</li>
</ul>
<p>It is <em>very important</em> that the auxiliary functions
(<code>eubank_1973.starting_vals()</code>,
<code>eubank_1973.lower_lims()</code> and
<code>eubank_1973.upper_lims()</code>) are named in this manner, to
allow the unified method for specifying and setting up starting
values/limits will not work.</p>
<hr>
<div class="section level4">
<h4 id="model-function---eubank_1973">Model function - <code>eubank_1973()</code><a class="anchor" aria-label="anchor" href="#model-function---eubank_1973"></a>
</h4>
<p>First of all we must implement the actual model itself (i.e. the
equation above, but as R code).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eubank_1973</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span>, <span class="va">topt</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">est</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">temp</span> <span class="op">-</span> <span class="va">topt</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A model function takes the parameters to fit the model as arguments,
with temperature being the first by convention, and returns the
estimates of the trait value at the given temperatures and parameter
values.</p>
<p>All of the models take temperature in ºC as their predictor variable.
If the model uses temperature in degrees Kelvin, then we change it
within the function, as seen in the Sharpe-Schoolfield models.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sharpeschoolhigh_1981</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span>, <span class="va">r_tref</span>, <span class="va">e</span>, <span class="va">eh</span>, <span class="va">th</span>, <span class="va">tref</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tref</span> <span class="op">&lt;-</span> <span class="fl">273.15</span> <span class="op">+</span> <span class="va">tref</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">8.62e-05</span></span>
<span>  <span class="va">boltzmann.term</span> <span class="op">&lt;-</span> <span class="va">r_tref</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">e</span><span class="op">/</span><span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">tref</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">temp</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">inactivation.term</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eh</span><span class="op">/</span><span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">th</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">temp</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">boltzmann.term</span> <span class="op">*</span> <span class="va">inactivation.term</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="starting-values---eubank_1973-starting_vals">Starting values - <code>eubank_1973.starting_vals()</code><a class="anchor" aria-label="anchor" href="#starting-values---eubank_1973-starting_vals"></a>
</h4>
<p>Deciding sensible starting values is notoriously tricky. In many
cases these are fairly arbitrary, though in certain cases an estimate
can be obtained from the data (e.g. for <span class="math inline">\(T_{opt}\)</span> or <span class="math inline">\(r_{max}\)</span>).</p>
<p>Starting values functions are provided a dataframe in their arguments
which is called <code>d</code> internally within the function, which
contains only the temperature and trait values for the given curve:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A slightly compressed example of how d is generated</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/padpadpadpad/rTPC" class="external-link">rTPC</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">subs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">chlorella_tpc</span>, <span class="va">chlorella_tpc</span><span class="op">$</span><span class="va">curve_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subs</span><span class="op">$</span><span class="va">temp</span>, y<span class="op">=</span><span class="va">subs</span><span class="op">$</span><span class="va">rate</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">d</span></span>
<span><span class="co">#&gt;     x          y</span></span>
<span><span class="co">#&gt; 1  16 0.12712578</span></span>
<span><span class="co">#&gt; 2  19 0.26596797</span></span>
<span><span class="co">#&gt; 3  22 0.38513241</span></span>
<span><span class="co">#&gt; 4  25 0.45183566</span></span>
<span><span class="co">#&gt; 5  28 0.83357098</span></span>
<span><span class="co">#&gt; 6  31 1.19034130</span></span>
<span><span class="co">#&gt; 7  34 0.95635362</span></span>
<span><span class="co">#&gt; 8  37 1.61689379</span></span>
<span><span class="co">#&gt; 9  40 1.47394412</span></span>
<span><span class="co">#&gt; 10 43 1.48238927</span></span>
<span><span class="co">#&gt; 11 46 0.02100078</span></span>
<span><span class="co">#&gt; 12 49 0.17843617</span></span></code></pre></div>
<p>Every <code>model.starting_values()</code> function has the same
approximate form, taking <code>d</code> as the only argument, and
returning a named list of starting values. So in our case:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eubank_1973.starting_vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># starting values go here</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>topt<span class="op">=</span><span class="va">topt</span>, a<span class="op">=</span><span class="va">a</span>, b<span class="op">=</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In the case of the eubank model, <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are arbitrary. As such we can take
fairly sensible values at approximately the right magnitude (say <span class="math inline">\(a = 300\)</span> and <span class="math inline">\(b
= 50\)</span>).</p>
<p><span class="math inline">\(T_{opt}\)</span> on the other hand is a
value that we can derive from our data, in this case it’s the
temperature at which <span class="math inline">\(rate\)</span> is at its
maximum.</p>
<p>So lets put that together in our <code>starting_vals</code>
function</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eubank_1973.starting_vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rmax</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># Find max trait value</span></span>
<span>  <span class="va">topt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">d</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="va">rmax</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Find T of rmax</span></span>
<span>  <span class="va">a</span> <span class="op">=</span> <span class="fl">300</span></span>
<span>  <span class="va">b</span> <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>topt<span class="op">=</span><span class="va">topt</span>, a<span class="op">=</span><span class="va">a</span>, b<span class="op">=</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To reiterate an earlier point, it is <strong>essential</strong> that
the starting values function is named appropriately,
e.g. <code>eubank_1973.starting_vals()</code>.</p>
<p>The following <strong>will not and can not work</strong>:</p>
<ul>
<li><code>eubank_1973.startingvals()</code></li>
<li><code>eubank_1973.start_vals()</code></li>
<li><code>eubank_1973_starting_vals()</code></li>
<li><code>.starting_vals()</code></li>
<li><code>model.starting_vals()</code></li>
</ul>
<hr>
</div>
<div class="section level4">
<h4 id="limits---eubank_1973-lower_lims-eubank_1973-upper_lims">Limits - <code>eubank_1973.lower_lims()</code> &amp;
<code>eubank_1973.upper_lims()</code><a class="anchor" aria-label="anchor" href="#limits---eubank_1973-lower_lims-eubank_1973-upper_lims"></a>
</h4>
<p>NLLS fitting often fails when unconstrained (as it may take one
parameter to infinity and ignore all others). Even specifying absurdly
large or infinite limits can make the optimiser behave better.</p>
<p>As such, it is often beneficial to provide realistic bounds on the
upper and lower limits of each parameter.</p>
<p>These take the same functional form as the <code>starting_vals</code>
function, requiring one argument (<code>d</code>) and returning a named
list.</p>
<p>Generally speaking it is best to keep limits fairly wide unless there
is a good biological reason to do otherwise.</p>
<p>For instance at most <span class="math inline">\(T_{opt}\)</span> is
never going to be above about 150 °C, and likely will be a lot lower.
And at its lower bound it is unlikely for the optimal trait value to
occur at temperatures below 0 °C. That gives us some fairly reasonable
bounds for the values of <span class="math inline">\(T_{opt}\)</span>.</p>
<p><span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, however, are arbitrary values. Just by
looking at the functional form of the model we can see that if <span class="math inline">\(a\)</span> goes to or below 0, or <span class="math inline">\(b = 0-(T-T_{opt})\)</span> then we will end up
with fairly nonsensical answers (either negative trait values or
undefined results), so we can bound those both on the low end at 0 to be
safe.</p>
<p>In terms of upper limits, we have no real idea of how large those
values may go (as they will be proportional to the units of the trait),
so we can’t set any reasonable bounds aside from <code>Inf</code>.</p>
<p>To put that together, here are the lower and upper limit functions
for <code>eubank_1976</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eubank_1973.lower_lims</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">topt</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="va">a</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="va">b</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>topt<span class="op">=</span><span class="va">topt</span>, a<span class="op">=</span><span class="va">a</span>, b<span class="op">=</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">eubank_1973.upper_lims</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">topt</span> <span class="op">=</span> <span class="fl">150</span></span>
<span>  <span class="va">a</span> <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="va">b</span> <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>topt<span class="op">=</span><span class="va">topt</span>, a<span class="op">=</span><span class="va">a</span>, b<span class="op">=</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h4>
<p>rTPC leverages <code>roxygen2</code> for documentation. Each file
contains documentation definitions at the <strong>top of the
file</strong> in special comments starting <code>#'</code>.</p>
<p>The best way to implement these is to copy from another model file
(such as <code>atkin_2005</code>) and modify it to suit your own
needs.</p>
<p>Things to modify:</p>
<ul>
<li>The first line description</li>
<li>parameters</li>
<li>author</li>
<li>reference</li>
<li>equation</li>
<li>note (if poorly fitting)</li>
<li>examples</li>
<li>export directive (this <strong>must</strong> match the name of the
model! The starting value and limit functions do not need
exporting)</li>
</ul>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="updating-the-model-database">Updating the model database<a class="anchor" aria-label="anchor" href="#updating-the-model-database"></a>
</h3>
<p>Once you have created a model file, you need to add this model to
rTPC’s database of model names, so it knows that the model is
available.</p>
<p>This simply requires modifying the <code>mod_names</code> vector
within the <code>get_model_names.R</code> file to include your new
model. Make sure that the model name is exactly the same as that in your
original file, and that it is enclosed in quotes.</p>
<hr>
</div>
<div class="section level3">
<h3 id="testing-model-implementation">Testing model implementation<a class="anchor" aria-label="anchor" href="#testing-model-implementation"></a>
</h3>
<p>Now that the model is set up, the next port of call is to simply run
the integration test.</p>
<p>This is located in the
<code>tests/testthat/test-startingvalues.R</code></p>
<p>It should provide a result somewhat like.</p>
<pre><code>[ FAIL 0 | WARN 0 | SKIP 0 | PASS 3 ]</code></pre>
<p>If the test failed, the output is instead more like this:</p>
<pre><code>[ FAIL 3 | WARN 0 | SKIP 0 | PASS 0 ]

── Failure (test-startingvalues.R:42:3): All models can generate starting values ──
length(mod_names) not equal to `starting_count`.
1/1 mismatches
[1] 48 - 47 == 1
No starting values for:
 ebank_1973

── Failure (test-startingvalues.R:46:3): All models can generate lower limits ──
length(mod_names) not equal to `lower_count`.
1/1 mismatches
[1] 48 - 47 == 1
No lower limits for:
 ebank_1973

── Failure (test-startingvalues.R:50:3): All models can generate upper limits ──
length(mod_names) not equal to `upper_count`.
1/1 mismatches
[1] 48 - 47 == 1
No upper limits for:
 ebank_1973
[ FAIL 3 | WARN 0 | SKIP 0 | PASS 0 ]</code></pre>
<p>In this case we can see that I simply misspelled the name of the
model in the <code>get_model_names.R</code> file, so need to change
that.</p>
<p>If only one test of the three failed, that is likely an issue with
the names of the functions in the actual model file.</p>
<hr>
</div>
<div class="section level3">
<h3 id="individual-model-test">Individual model test<a class="anchor" aria-label="anchor" href="#individual-model-test"></a>
</h3>
<p>Each model requires a model test, to make sure that changes in the
future do not cause major fitting issues. These test files live in the
<code>tests/testthat</code> directory.</p>
<p>Creating a new one in RStudio is easy! Just make sure you have your
model file in the script window, then run the command
<code>usethis::use_test()</code>.</p>
<p>This will create a new test file, in our case
<code>tests/testthat/test-eubank_1973.R</code></p>
<p>Tests are mostly boilerplate, however there are a few things that do
need to be changed, so again you can copy most of the code from another
test file, such as <code>test-atkin_2005.R</code>.</p>
<p>The main items to be changed are:</p>
<ul>
<li>The model name throughout (5 occurrences)</li>
<li>The model arguments within <code>nls_multstart</code>
</li>
<li>The <code>iter</code> argument to <code>nls_multstart</code> (this
should be something like <code>c(3,3,3,3)</code> for a model with 4 free
parameters)</li>
</ul>
<p>So the final test file will look something like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do not run the test on CRAN as they take too long</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">skip_on_cran</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># method: fit model and get predictions. Check these against others.</span></span>
<span></span>
<span><span class="co"># load in ggplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># subset for the first TPC curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'chlorella_tpc'</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">chlorella_tpc</span>, <span class="va">curve_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get start values and fit model</span></span>
<span><span class="va">start_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">temp</span>, <span class="va">d</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'eubank_1973'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">nls.multstart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html" class="external-link">nls_multstart</a></span><span class="op">(</span><span class="va">rate</span><span class="op">~</span><span class="fu"><a href="../reference/eubank_1973.html">eubank_1973</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>, <span class="va">tops</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>,</span>
<span>                                    data <span class="op">=</span> <span class="va">d</span>,</span>
<span>                                    iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                                    start_lower <span class="op">=</span> <span class="va">start_vals</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>                                    start_upper <span class="op">=</span> <span class="va">start_vals</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>                                    lower <span class="op">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">temp</span>, <span class="va">d</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'eubank_1973'</span><span class="op">)</span>,</span>
<span>                                    upper <span class="op">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">temp</span>, <span class="va">d</span><span class="op">$</span><span class="va">rate</span>, model_name <span class="op">=</span> <span class="st">'eubank_1973'</span><span class="op">)</span>,</span>
<span>                                    supp_errors <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                                    convergence_count <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get predictions</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co"># dput(round(preds$.fitted, 1))</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run test</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"eubank_1973 function works"</span>, <span class="op">{</span></span>
<span>  <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">.fitted</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span>, <span class="fl">1.4</span>, <span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<hr>
<div class="section level4">
<h4 id="getting-results-values">Getting results values<a class="anchor" aria-label="anchor" href="#getting-results-values"></a>
</h4>
<p>The second-from-final line in the test file defines the expected
return from a model run. It is not really feasible to know this ahead of
time, but luckily the code here contains an extra function that makes
retrieving the expected value easy.</p>
<p>Before running the test for the first time, uncomment (remove the
hashtag) the line <code># dput(round(preds$.fitted, 1))</code>.</p>
<p>Now when you run the test with
<code>testthat::test_file("tests/testthat/test-eubank_1973.R")</code>
then the test will very likely fail, but it will also output a vector to
the console.</p>
<pre><code>[ FAIL 0 | WARN 0 | SKIP 0 | PASS 0 ]c(0.2, 0.2, 0.3, 0.4, 0.6, 0.9, 1.3, 1.6, 1.4, 1, 0.7, 0.4)
[ FAIL 1 | WARN 0 | SKIP 0 | PASS 0 ]

── Failure (test-eubank_1973.R:39:3): eubank_1973 function works ───────────────
round(preds$.fitted, 1) not equal to c(0.2, 0.3, 0.5, 0.6, 0.8, 1, 1.1, 1.2, 1.3, 1.2, 1, 0.1).
11/12 mismatches (average diff: 0.209)
[2]  0.2 - 0.3 == -0.1
[3]  0.3 - 0.5 == -0.2
[4]  0.4 - 0.6 == -0.2
[5]  0.6 - 0.8 == -0.2
[6]  0.9 - 1.0 == -0.1
[7]  1.3 - 1.1 ==  0.2
[8]  1.6 - 1.2 ==  0.4
[9]  1.4 - 1.3 ==  0.1
[10] 1.0 - 1.2 == -0.2
...
[ FAIL 1 | WARN 0 | SKIP 0 | PASS 0 ]</code></pre>
<p>You can paste this vector (in this case
<code>c(0.2, 0.2, 0.3, 0.4, 0.6, 0.9, 1.3, 1.6, 1.4, 1, 0.7, 0.4)</code>)
onto the second from last line (remembering the extra closing
parenthesis), then save and run again.</p>
<p>On this second run the test should execute properly.</p>
<pre><code>[ FAIL 0 | WARN 0 | SKIP 0 | PASS 1 ]</code></pre>
<p>You can then proceed with commenting back out the <code><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput()</a></code>
line.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<p>At this point it is worth doing a bit of testing of your new
function.</p>
<p>Load your new version of the package with
<code>devtools::load_all(".")</code> and then in a new R (or Rmarkdown)
file try running some tests with your new function.</p>
<p>If you are having trouble with fitting, modify your starting values
or limits and try again until you get fairly good fits.</p>
<p>You may also have to play with the <code>iter</code> argument to
<code>nls_multstart</code>.</p>
<p>Once you are happy with everything it’s time to run R CMD CHECK (for
example using <code>devtools::check()</code>).</p>
<p>Look to make sure that there are no warnings or errors.</p>
<pre><code>── R CMD check results ──
Duration: 4m 55.6s

0 errors ✔ | 0 warnings ✔ | 0 notes ✔

R CMD check succeeded</code></pre>
<hr>
</div>
<div class="section level2">
<h2 id="documenting-your-model">Documenting your model<a class="anchor" aria-label="anchor" href="#documenting-your-model"></a>
</h2>
<p>Documentation needs to be generated in order to be available for your
own model.</p>
<p>To do this, simply run the command
<code>devtools::document()</code>.</p>
<p>Once this has completed you can view your documentation internally
using <code>?modelname_yyyy</code>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="commiting-your-changes-back-upstream">Commiting your changes back upstream<a class="anchor" aria-label="anchor" href="#commiting-your-changes-back-upstream"></a>
</h2>
<p>Now you have fully implemented your model it is time to hand it back
to the rTPC team for integration.</p>
<p>The simplest way to do this is to commit your changes (including the
.Rd documentation file), push those to your own forked repo, then open a
pull request (a prompt should appear on your repo on the github
website).</p>
<p>Please make sure you include a sensible title such as “Add
eubank_1976 model”.</p>
<p>Include in the description any notes about the model itself,
decisions you may have had to make when creating it, or problems and
difficulties when fitting the model.</p>
<p>See <a href="https://github.com/padpadpadpad/rTPC/pull/58" class="external-link">PR #58</a>
for an example of a good pull request.</p>
<hr>
</div>
<div class="section level2">
<h2 id="done">Done!<a class="anchor" aria-label="anchor" href="#done"></a>
</h2>
<p>Now you are done and can go and have a well-earned cup of tea! You
deserve it!</p>
<hr>
</div>
<div class="section level2">
<h2 id="auxiliary-model-function-dispatch">Auxiliary model function dispatch<a class="anchor" aria-label="anchor" href="#auxiliary-model-function-dispatch"></a>
</h2>
<p><em>A note on <strong>how</strong> rTPC dispatches auxiliary model
functions</em></p>
<p>Under the hood, rTPC relies on the <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> function to
locate and run the appropriate model functions.</p>
<p>A good example of this is when getting starting values.</p>
<p>The <code><a href="../reference/get_start_vals.html">get_start_vals()</a></code> function in its entirety is
replicated here:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_start_vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">model_name</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">mod_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_model_names.html">get_model_names</a></span><span class="op">(</span>returnall <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">model_name</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/arg_match.html" class="external-link">arg_match</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="va">mod_names</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">=</span><span class="st">"Supplied {.arg model_name} ({.val {model_name}}) is not an available model in rTPC."</span>,</span>
<span>                     <span class="st">"!"</span><span class="op">=</span><span class="st">"Please check the spelling of {.arg model_name}."</span>,</span>
<span>                     <span class="st">" "</span><span class="op">=</span><span class="st">"(run {.fn rTPC::get_model_names} to see all valid names.)"</span>,</span>
<span>                     <span class="st">""</span><span class="op">)</span>, call<span class="op">=</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># make data frame</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span>  <span class="va">start_vals</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="st">".starting_vals"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d<span class="op">=</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">{</span><span class="cn">NULL</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">start_vals</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here the model name is checked against the list of valid models, and
a source data frame (<code>d</code>) is created.</p>
<p>Finally a model function name is created by pasting together the name
of the model along with <code>".starting_vals"</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="st">"eubank_1976"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_name</span>, <span class="st">".starting_vals"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "eubank_1976.starting_vals"</span></span></code></pre></div>
<p>This function name is then executed using <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code>
along with a list of arguments (in this case simply <code>d</code>), and
the value is returned.</p>
<p>If a model function is not present or is spelled incorrectly,
<code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> will throw an error which the
<code>tryCatch</code> will convert into a <code>NULL</code> output.</p>
<p>In the case of an entirely missing model,
<code><a href="../reference/get_start_vals.html">get_start_vals()</a></code> errors out early with a more specific
error message.</p>
<p><span style="opacity: 0.1;font-size: small;">Built in
0.6967473s</span></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Padfield, Hannah O’Sullivan, Francis Windram.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
