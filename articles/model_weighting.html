<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model weighting with rTPC â€¢ rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Model weighting with rTPC">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rTPC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rTPC.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting a single curve</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_models.html">Fitting many models with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_weighting.html">Model weighting with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/weighted_bootstrapping.html">Bootstrapping with weights using rTPC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Fitting many curves</h6></li>
    <li><a class="dropdown-item" href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrapping_many_curves.html">Bootstrapping many curves using rTPC</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Contributing to rTPC</h6></li>
    <li><a class="dropdown-item" href="../articles/adding_models.html">Adding Models to rTPC</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/padpadpadpad/rTPC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model weighting with rTPC</h1>
                        <h4 data-toc-skip class="author">Daniel
Padfield</h4>
            
            <h4 data-toc-skip class="date">2025-02-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/master/vignettes/model_weighting.Rmd" class="external-link"><code>vignettes/model_weighting.Rmd</code></a></small>
      <div class="d-none name"><code>model_weighting.Rmd</code></div>
    </div>

    
    
<div class="section level4">
<h4 id="a-brief-example-of-how-model-weighting-can-be-used-to-help-account-for-measurement-uncertainty-when-fitting-models-to-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-">A brief example of how model weighting can be used to help account
for measurement uncertainty when fitting models to TPCs using rTPC,
nls.multstart, and the tidyverse.<a class="anchor" aria-label="anchor" href="#a-brief-example-of-how-model-weighting-can-be-used-to-help-account-for-measurement-uncertainty-when-fitting-models-to-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-"></a>
</h4>
<hr>
</div>
<div class="section level2">
<h2 id="things-to-consider">Things to consider<a class="anchor" aria-label="anchor" href="#things-to-consider"></a>
</h2>
<ul>
<li>The optimal weighting is <span class="math inline">\(\frac{1}{\sigma}\)</span>. The standard deviation
is easy to calculate when calculating the means of the rate data.</li>
<li>Carefully consider your level of replication before undertaking your
statistical analysis.
<ul>
<li>What is your level of replication?</li>
<li>Do you have biological replicates or technical replicates?</li>
<li>Do you have non-independence in your dataset?</li>
</ul>
</li>
</ul>
<hr>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/padpadpadpad/rTPC" class="external-link">rTPC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">nls.multstart</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span></code></pre></div>
<p>The general pipeline demonstrates how models can be fitted,
parameters extracted, and predictions plotted to single or multiple
curves using functions in <strong>rTPC</strong>,
<strong>nls_multstart()</strong>, and <strong>purrr</strong>.</p>
</div>
<div class="section level2">
<h2 id="using-model-weights">Using model weights<a class="anchor" aria-label="anchor" href="#using-model-weights"></a>
</h2>
<p>Here, we demonstrate how this pipeline can easily be extended to
incorporate measurement uncertainty by using the <code>weights</code>
argument of <strong>nls_multstart()</strong>. Methods of fitting TPCs in
the literature often fit models to averaged rate values at each
temperature. This fits a model on the mean rate value, but often the
variation around this calculated mean value is ignored. However, there
may be more spread in the rate data at the extreme temperatures (very
hot or very cold). Ignoring the homoscedasticity in the data may alter
the model fit.</p>
<p>Instead, we can incorporate measurement uncertainty using the
<strong>weights</strong> argument within
<strong>nls_multstart()</strong>, to perform a weighted non-linear least
squares regression. The optimal weight for each data point is the
standard deviation, <span class="math inline">\(1/\sigma\)</span>, which
easily be calculated when averaging over technical or biological
replicates.</p>
<p>We can demonstrate weighted non-linear least squares regression by
using the example dataset contained within <strong>rTPC</strong> - a
dataset of 60 TPCs of respiration and photosynthesis of the aquatic
algae, <em>Chlorella vulgaris</em>. Instead of plotting a single curve,
we average over the biological replicates, <code>rep</code>, within a
growth temperature, to get mean rate values at each assay temperature
and their standard deviation. These are then plotted using
<strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get curve data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"chlorella_tpc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_ave</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">chlorella_tpc</span>, <span class="va">process</span> <span class="op">==</span> <span class="st">'adaptation'</span>, <span class="va">growth_temp</span> <span class="op">==</span> <span class="fl">33</span>, <span class="va">flux</span> <span class="op">==</span> <span class="st">'photosynthesis'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">flux</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">.</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>            ave_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'temp'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp</span>, ymin <span class="op">=</span> <span class="va">ave_rate</span> <span class="op">-</span> <span class="va">sd</span>, ymax <span class="op">=</span> <span class="va">ave_rate</span> <span class="op">+</span> <span class="va">sd</span><span class="op">)</span>, <span class="va">d_ave</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ave_rate</span><span class="op">)</span>, <span class="va">d_ave</span>, size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">21</span>, fill <span class="op">=</span> <span class="st">'green4'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span><span class="st">'Temperature (ÂºC)'</span>,</span>
<span>       y <span class="op">=</span> <span class="st">'Metabolic rate'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">'Photosynthesis rates across temperatures'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_weighting_files/figure-html/get_data-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this example, the standard deviation in our rates are actually
smallest at the extreme temperatures, counter to what we previously
expected.</p>
<p>We will use the workflows outlined in the previous vignettes on <a href="fit_many_models.html">fitting many models</a> and <a href="fit_many_curves.html">fitting many curves</a> to fit both weighted
and standard non-linear least squares regression, and we will use the
<strong>kamykowski_1985()</strong> in this example - purely because it
has not been used in previous vignettes as of yet.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit kamykowski model using rTPC with and without weights</span></span>
<span><span class="va">d_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="va">d_ave</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ave_rate</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>standard <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html" class="external-link">nls_multstart</a></span><span class="op">(</span><span class="va">ave_rate</span><span class="op">~</span><span class="fu"><a href="../reference/kamykowski_1985.html">kamykowski_1985</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span><span class="op">)</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                        iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>                        start_lower <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>                        start_upper <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span>,</span>
<span>                        upper <span class="op">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span>,</span>
<span>                        supp_errors <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                        convergence_count <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         weighted <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html" class="external-link">nls_multstart</a></span><span class="op">(</span><span class="va">ave_rate</span><span class="op">~</span><span class="fu"><a href="../reference/kamykowski_1985.html">kamykowski_1985</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span><span class="op">)</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                        iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>                        start_lower <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>                        start_upper <span class="op">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>                        lower <span class="op">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span>,</span>
<span>                        upper <span class="op">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">temp</span>, <span class="va">.x</span><span class="op">$</span><span class="va">ave_rate</span>, model_name <span class="op">=</span> <span class="st">'kamykowski_1985'</span><span class="op">)</span>,</span>
<span>                        supp_errors <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>                        convergence_count <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        <span class="co"># include weights here!</span></span>
<span>                        modelweights <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_fits</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 4</span></span></span>
<span><span class="co">#&gt;   flux           data              standard weighted</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> photosynthesis <span style="color: #949494;">&lt;tibble [11 Ã— 3]&gt;</span> <span style="color: #949494;">&lt;nls&gt;</span>    <span style="color: #949494;">&lt;nls&gt;</span></span></span></code></pre></div>
<p>We can then get the predictions and plot them as before.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack models</span></span>
<span><span class="va">d_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">d_fits</span>, <span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, names_to <span class="op">=</span> <span class="st">'model_name'</span>, values_to <span class="op">=</span> <span class="st">'fit'</span>, <span class="va">standard</span><span class="op">:</span><span class="va">weighted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get predictions using augment</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">d_ave</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">d_ave</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d_preds</span> <span class="op">&lt;-</span> <span class="va">d_stack</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.</span>, preds <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">augment</span>, newdata <span class="op">=</span> <span class="va">newdata</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take a random point from each model for labelling</span></span>
<span><span class="va">d_labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">d_preds</span>, <span class="va">temp</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">model_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get topt for each model</span></span>
<span><span class="va">d_topt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">d_stack</span>, topt <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">get_topt</span><span class="op">)</span>, rmax <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">get_rmax</span><span class="op">)</span>,</span>
<span>                 topt_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">topt</span>, <span class="st">'ÂºC'</span>, sep <span class="op">=</span> <span class="st">' '</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">d_preds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">.fitted</span>, col <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">.fitted</span>, label <span class="op">=</span> <span class="va">model_name</span>, col <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'white'</span>, nudge_y <span class="op">=</span> <span class="fl">0.8</span>, segment.size <span class="op">=</span> <span class="fl">0.2</span>, segment.colour <span class="op">=</span> <span class="st">'grey50'</span>, <span class="va">d_labs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp</span>, ymin <span class="op">=</span> <span class="va">ave_rate</span> <span class="op">-</span> <span class="va">sd</span>, ymax <span class="op">=</span> <span class="va">ave_rate</span> <span class="op">+</span> <span class="va">sd</span><span class="op">)</span>, <span class="va">d_ave</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ave_rate</span><span class="op">)</span>, <span class="va">d_ave</span>, size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">21</span>, fill <span class="op">=</span> <span class="st">'green4'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">topt</span>, <span class="va">rmax</span>, label <span class="op">=</span> <span class="va">topt_text</span>, col <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'white'</span>, nudge_y <span class="op">=</span> <span class="fl">0.8</span>, segment.size <span class="op">=</span> <span class="fl">0.2</span>, segment.colour <span class="op">=</span> <span class="st">'grey50'</span>, <span class="va">d_topt</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">topt</span>, <span class="va">rmax</span>, col <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, <span class="va">d_topt</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Temperature (ÂºC)'</span>,</span>
<span>       y <span class="op">=</span> <span class="st">'Metabolic rate'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">'Photosynthesis rates across temperatures'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'qual'</span>, palette <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model_weighting_files/figure-html/preds_and_plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Here, we can see that weighting the regression by the standard
deviation of the average rate value at each temperature increases the
optimum temperature by approximately 2 ÂºC. This is a big relative shift,
and could have big consequences for any downstream analyses that might
be applied. The model weighting approach can easily be combined with <a href="model_averaging_selection.html">model selection/averaging</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Padfield, Hannah Oâ€™Sullivan, Francis Windram.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
